<section id="nice" data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size: 16px; color: black; padding: 0 10px; line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; word-break: break-word; word-wrap: break-word; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, 'PingFang SC', Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;"><h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; font-size: 22px; color: #009688; padding-left: 10px; margin: 1em auto; border-left: 3px solid #009688;"><span class="prefix" style="display: none;"></span><span class="content">线程本地存储</span><span class="suffix"></span></h2>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="border: none; display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; background: rgba(0, 0, 0, 0.05); padding-top: 10px; padding-bottom: 10px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; border-left: 2px solid #888; border-right: 2px solid #888; padding-left: 1em; color: #777;">
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; text-align: justify; margin: 0px; color: black; line-height: 26px;">线程本地存储（Thread Local Storage），字面意思就是专属某个线程的存储空间。为了避免多线程情况下的共享变量的锁竞争，需要将共变量的作用范围设置为最小。也就是线程级别。</p>
</blockquote>
<h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; font-size: 22px; color: #009688; padding-left: 10px; margin: 1em auto; border-left: 3px solid #009688;"><span class="prefix" style="display: none;"></span><span class="content">C#中的线程本地存储</span><span class="suffix"></span></h2>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">c#中的线程本地存储目前大致有三种</p>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin: 0.6em auto; padding-left: 10px; border-left: 2px solid #009688;"><span class="prefix" style="display: none;"></span><span class="content">1. ThreadStaticAttribute</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">这种方式本质上工作线程拿到的是初始化值，主线程拿到的是定义时设置的值。所以加入将一个共享变量打上<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #009688;">ThreadStatic</code>标记。工作线程会在本地对应一份，但是值是默认值不会使用定义是设置的值。比如int就是默认为0。引用类型即为null</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; background: #282c34; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;">[<span class="hljs-meta" style="color: #61aeee; line-height: 26px;">ThreadStatic</span>]<br><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">public</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">static</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">int</span>&nbsp;Value&nbsp;=&nbsp;<span class="hljs-number" style="color: #d19a66; line-height: 26px;">10</span>;<br><br><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">private</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">readonly</span>&nbsp;ILogger&lt;WeatherForecastController&gt;&nbsp;_logger;<br><br><span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">public</span>&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">WeatherForecastController</span>(<span class="hljs-params" style="line-height: 26px;">ILogger&lt;WeatherForecastController&gt;&nbsp;logger</span>)</span><br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;_logger&nbsp;=&nbsp;logger;<br>}<br><br>[<span class="hljs-meta" style="color: #61aeee; line-height: 26px;">HttpGet(Name&nbsp;=&nbsp;<span class="hljs-meta-string" style="color: #98c379; line-height: 26px;">"GetWeatherForecast"</span>)</span>]<br><span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">public</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">string</span>&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">Get</span>(<span class="hljs-params" style="line-height: 26px;"></span>)</span><br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;_logger.LogInformation(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"this&nbsp;value&nbsp;in&nbsp;thread&nbsp;{a}&nbsp;is&nbsp;{value}"</span>,&nbsp;Thread.CurrentThread.ManagedThreadId,Value);<br>&nbsp;&nbsp;&nbsp;&nbsp;Task.Factory.StartNew(()&nbsp;=&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger.LogInformation(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"this&nbsp;value&nbsp;in&nbsp;thread&nbsp;{a}&nbsp;is&nbsp;{value}"</span>,&nbsp;Thread.CurrentThread.ManagedThreadId,Value);<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;Task.Factory.StartNew(()&nbsp;=&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger.LogInformation(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"this&nbsp;value&nbsp;in&nbsp;thread&nbsp;{a}&nbsp;is&nbsp;{value}"</span>,&nbsp;Thread.CurrentThread.ManagedThreadId,Value);<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">return</span>&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"ok"</span>;<br>}<br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">以上代码会输出：</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://cdn.jsdelivr.net/gh/Daphnedepay/7nBQHeoTqK/20220512/20220512212553198.png" alt style="display: block; margin: 0 auto; max-width: 100%;"></figure>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin: 0.6em auto; padding-left: 10px; border-left: 2px solid #009688;"><span class="prefix" style="display: none;"></span><span class="content">2. ThreadLocal</span><span class="suffix" style="display: none;"></span></h3>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; background: #282c34; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;">[<span class="hljs-meta" style="color: #61aeee; line-height: 26px;">ApiController</span>]<br>[<span class="hljs-meta" style="color: #61aeee; line-height: 26px;">Route(<span class="hljs-meta-string" style="color: #98c379; line-height: 26px;">"[controller]"</span>)</span>]<br><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">public</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">class</span>&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">TestController</span>&nbsp;:&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">ControllerBase</span><br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">private</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">readonly</span>&nbsp;ThreadLocal&lt;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">int</span>&gt;&nbsp;_threadLocal=<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">new</span>&nbsp;ThreadLocal&lt;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">int</span>&gt;(()=&gt;<span class="hljs-number" style="color: #d19a66; line-height: 26px;">10</span>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">private</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">readonly</span>&nbsp;ILogger&lt;TestController&gt;&nbsp;_logger;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">public</span>&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">TestController</span>(<span class="hljs-params" style="line-height: 26px;">ILogger&lt;TestController&gt;&nbsp;logger</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger&nbsp;=&nbsp;logger;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;[<span class="hljs-meta" style="color: #61aeee; line-height: 26px;">HttpGet</span>]<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">public</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">string</span>&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">Get</span>(<span class="hljs-params" style="line-height: 26px;"></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger.LogInformation(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"this&nbsp;value&nbsp;in&nbsp;thread&nbsp;{a}&nbsp;is&nbsp;{value}"</span>,&nbsp;Thread.CurrentThread.ManagedThreadId,_threadLocal.Value);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Task.Factory.StartNew(()&nbsp;=&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger.LogInformation(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"this&nbsp;value&nbsp;in&nbsp;thread&nbsp;{a}&nbsp;is&nbsp;{value}"</span>,&nbsp;Thread.CurrentThread.ManagedThreadId,_threadLocal.Value);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Task.Factory.StartNew(()&nbsp;=&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger.LogInformation(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"this&nbsp;value&nbsp;in&nbsp;thread&nbsp;{a}&nbsp;is&nbsp;{value}"</span>,&nbsp;Thread.CurrentThread.ManagedThreadId,_threadLocal.Value);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">return</span>&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"ok"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">以上代码会输出：</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://cdn.jsdelivr.net/gh/Daphnedepay/7nBQHeoTqK/20220512/20220512213018179.png" alt style="display: block; margin: 0 auto; max-width: 100%;"></figure>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin: 0.6em auto; padding-left: 10px; border-left: 2px solid #009688;"><span class="prefix" style="display: none;"></span><span class="content">AsyncLocal</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">AsyncLocal的使用场景：HttpContextAccessor</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; background: #282c34; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;">[ApiController]<br>[Route(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"[controller]"</span>)]<br>public&nbsp;class&nbsp;DemoController&nbsp;:&nbsp;ControllerBase<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">readonly</span>&nbsp;AsyncLocal&lt;int&gt;&nbsp;_threadLocal=new&nbsp;AsyncLocal&lt;int&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">readonly</span>&nbsp;ILogger&lt;DemoController&gt;&nbsp;_logger;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;DemoController(ILogger&lt;DemoController&gt;&nbsp;logger)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger&nbsp;=&nbsp;logger;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_threadLocal.Value&nbsp;=&nbsp;10;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;[HttpGet]<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;string&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">Get</span></span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger.LogInformation(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"this&nbsp;value&nbsp;in&nbsp;thread&nbsp;{a}&nbsp;is&nbsp;{value}"</span>,&nbsp;Thread.CurrentThread.ManagedThreadId,_threadLocal.Value);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Task.Factory.StartNew(()&nbsp;=&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger.LogInformation(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"this&nbsp;value&nbsp;in&nbsp;thread&nbsp;{a}&nbsp;is&nbsp;{value}"</span>,&nbsp;Thread.CurrentThread.ManagedThreadId,_threadLocal.Value);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Task.Factory.StartNew(()&nbsp;=&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger.LogInformation(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"this&nbsp;value&nbsp;in&nbsp;thread&nbsp;{a}&nbsp;is&nbsp;{value}"</span>,&nbsp;Thread.CurrentThread.ManagedThreadId,_threadLocal.Value);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">return</span>&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"ok"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">以上执行会输出：</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://cdn.jsdelivr.net/gh/Daphnedepay/7nBQHeoTqK/20220512/20220512213701030.png" alt style="display: block; margin: 0 auto; max-width: 100%;"></figure>
<h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; font-size: 22px; color: #009688; padding-left: 10px; margin: 1em auto; border-left: 3px solid #009688;"><span class="prefix" style="display: none;"></span><span class="content">使用线程本地存储实现简单的调用链追踪</span><span class="suffix"></span></h2>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; background: #282c34; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;">public&nbsp;class&nbsp;DemoController&nbsp;:&nbsp;ControllerBase<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">readonly</span>&nbsp;AsyncLocal&lt;List&lt;string&gt;&gt;&nbsp;_threadLocal=new&nbsp;AsyncLocal&lt;List&lt;string&gt;&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">readonly</span>&nbsp;ILogger&lt;DemoController&gt;&nbsp;_logger;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;DemoController(ILogger&lt;DemoController&gt;&nbsp;logger)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger&nbsp;=&nbsp;logger;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_threadLocal.Value&nbsp;=&nbsp;new&nbsp;List&lt;string&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;[HttpGet]<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;string&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">Get</span></span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger.LogInformation(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"this&nbsp;value&nbsp;in&nbsp;thread&nbsp;{a}&nbsp;is&nbsp;{value}"</span>,&nbsp;Thread.CurrentThread.ManagedThreadId,_threadLocal.Value);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger.LogInformation(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"_threadLocal.Value：&nbsp;{value}"</span>,&nbsp;string.Join(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"==&gt;"</span>,&nbsp;_threadLocal.Value??new&nbsp;List&lt;string&gt;()));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">return</span>&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"ok"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">A</span></span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_threadLocal.Value?.Add(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"A"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">B</span></span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_threadLocal.Value?.Add(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"B"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">if</span>&nbsp;(DateTime.Now.Second%2==0)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">else</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">C</span></span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_threadLocal.Value?.Add(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"C"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">D</span></span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_threadLocal.Value?.Add(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"D"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>}<br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">输出示例：</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://cdn.jsdelivr.net/gh/Daphnedepay/7nBQHeoTqK/20220512/20220512214346124.png" alt style="display: block; margin: 0 auto; max-width: 100%;"></figure>
<h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; font-size: 22px; color: #009688; padding-left: 10px; margin: 1em auto; border-left: 3px solid #009688;"><span class="prefix" style="display: none;"></span><span class="content">一些应用场景</span><span class="suffix"></span></h2>
<ol data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: decimal;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">一些连接池(数据库连接池)</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">链路追踪工具，如skywalking、zkipin等</section></li></ol>
</section>