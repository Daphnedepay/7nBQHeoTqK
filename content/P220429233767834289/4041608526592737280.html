<section id="nice" data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size: 16px; color: black; padding: 0 10px; line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; word-break: break-word; word-wrap: break-word; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, 'PingFang SC', Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;"><h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px;"><span class="prefix" style="display: none;"></span><span class="content">封装aliyun rockenmq的事件总线</span><span class="suffix"></span></h2>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">本工具是一款支持阿里云rocketmq的事件消息总线工具包，支持类型化事件、动态事件、支持运行时解绑事件处理程序和重新绑定事件处理程序，支持多绑定。最少依赖，减少版本升级的困扰</p>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span class="prefix" style="display: none;"></span><span class="content">使用方式</span><span class="suffix" style="display: none;"></span></h3>
<ol data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: decimal;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">安装nuget包：</section></li></ol>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; background: #282c34; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;">Install-Package&nbsp;Dncy.EventBus.AliyunRocketMQ&nbsp;-Version&nbsp;1.2.1<br></code></pre>
<ol start="2" data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: decimal;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">注入mq</section></li></ol>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; background: #282c34; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;">services.AddMqClient(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"accesskey"</span>,&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"secret"</span>,&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"httphost"</span>);<br>//&nbsp;事件管理器，默认使用内存，可自行事件对应接口<br>services.AddSingleton&lt;IEventBusSubscriptionsManager,&nbsp;InMemoryEventBusSubscriptionsManager&gt;();<br>services.AddSingleton&lt;DemoHandler&gt;();<br>//&nbsp;消息序列化器<br>services.AddTransient&lt;IMessageSerializeProvider,&nbsp;NewtonsoftMessageSerializeProvider&gt;();<br>services.AddSingleton&lt;IEventBus,&nbsp;EventBusRocketMQ&gt;(sp&nbsp;=&gt;<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;logger&nbsp;=&nbsp;sp.GetRequiredService&lt;ILogger&lt;EventBusRocketMQ&gt;&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;mqClient&nbsp;=&nbsp;sp.GetRequiredService&lt;MQClient&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;subMgr&nbsp;=&nbsp;sp.GetRequiredService&lt;IEventBusSubscriptionsManager&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;serviceFactory&nbsp;=&nbsp;sp.GetRequiredService&lt;IServiceScopeFactory&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;serializeProvider&nbsp;=&nbsp;sp.GetRequiredService&lt;IMessageSerializeProvider&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">return</span>&nbsp;new&nbsp;EventBusRocketMQ(mqClient,&nbsp;subMgr,&nbsp;serviceFactory,&nbsp;new&nbsp;AliyunRocketMqOption(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"instranceid"</span>,&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"topicid"</span>,&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"groupid"</span>),&nbsp;serializeProvider,&nbsp;logger);<br>});<br></code></pre>
<h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px;"><span class="prefix" style="display: none;"></span><span class="content">事件处理程序示例：</span><span class="suffix"></span></h2>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; background: #282c34; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;">public&nbsp;class&nbsp;DemoHandler&nbsp;:&nbsp;IIntegrationEventHandler&lt;DemoEvent&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">readonly</span>&nbsp;ILogger&lt;DemoHandler&gt;&nbsp;_logger;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;DemoHandler(ILogger&lt;DemoHandler&gt;&nbsp;logger)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger&nbsp;=&nbsp;logger;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;///&nbsp;&lt;inheritdoc&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;async&nbsp;Task&nbsp;Handle(DemoEvent&nbsp;@event)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">if</span>&nbsp;(@event&nbsp;==&nbsp;null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger.LogWarning(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"【DemoHandler】接收到&nbsp;DemoEvent。&nbsp;数据为空"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_logger.LogInformation(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"【DemoHandler】接收到&nbsp;DemoEvent&nbsp;。&nbsp;数据：{@event}"</span>,JsonSerializer.Serialize(@event));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await&nbsp;Task.Delay(2000);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br></code></pre>
</section>