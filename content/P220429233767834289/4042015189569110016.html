<section id="nice" data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size: 16px; color: black; padding: 0 10px; line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; word-break: break-word; word-wrap: break-word; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, 'PingFang SC', Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;"><h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; border-bottom: 2px solid rgb(239, 112, 96); font-size: 1.3em;"><span class="prefix" style="display: none;"></span><span class="content" style="display: inline-block; font-weight: bold; background: rgb(239, 112, 96); color: #ffffff; padding: 3px 10px 1px; border-top-right-radius: 3px; border-top-left-radius: 3px; margin-right: 3px;">redis简介</span><span class="suffix"></span><span style="display: inline-block; vertical-align: bottom; border-bottom: 36px solid #efebe9; border-right: 20px solid transparent;"> </span></h2>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="border: none; display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; border-left: 3px solid rgba(0, 0, 0, 0.4); color: #6a737d; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; border-left-color: rgb(239, 112, 96); background: #fff9f9;">
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0px; color: black; line-height: 26px;">Redis 是一个高性能的 key-value 数据库。
redis 的优势性能高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。
原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。。</p>
</blockquote>
<h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; border-bottom: 2px solid rgb(239, 112, 96); font-size: 1.3em;"><span class="prefix" style="display: none;"></span><span class="content" style="display: inline-block; font-weight: bold; background: rgb(239, 112, 96); color: #ffffff; padding: 3px 10px 1px; border-top-right-radius: 3px; border-top-left-radius: 3px; margin-right: 3px;">使用redis实现排行榜功能</span><span class="suffix"></span><span style="display: inline-block; vertical-align: bottom; border-bottom: 36px solid #efebe9; border-right: 20px solid transparent;"> </span></h2>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">众所周知，redis的zset结构天然具有排序功能，可以通过简单的命令确定顺序，使用members来作为排序的标识，score作为排行依据，简单易用。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">需要用到的zset的操作命令:</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">ZINCRBY key increment member ：有序集合中对指定成员的分数加上增量 increment</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">ZRANGE key start stop [WITHSCORES] ：返回有序集合指定区间内的成员</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">ZREVRANK key member： 返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序</section></li></ul>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">当然还有其余更多的命令，具体可以查看：<a href="https://www.runoob.com/redis/redis-sorted-sets.html" style="text-decoration: none; word-wrap: break-word; font-weight: bold; color: rgb(239, 112, 96); border-bottom: 1px solid rgb(239, 112, 96);">redis - zet</a></p>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span class="prefix" style="display: none;"></span><span class="content">1. key的设计</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">假定我们的积分排行有日榜、周榜、月榜，这里以日榜为例，可以使用当日时间作为key的组成部分，比如：<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgb(239, 112, 96);">ranks:20220503</code>。</p>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span class="prefix" style="display: none;"></span><span class="content">2. member的score的zset累加</span><span class="suffix" style="display: none;"></span></h3>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">用户A 进行了操作a，获得了8分,我们将其放入redis进行累加</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; background: #282c34; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;">ZINCRBY&nbsp;RANK:20220503&nbsp;8&nbsp;A<br></code></pre>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">用户B进行了b操作，获取了20分，同样放入redis</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; background: #282c34; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;">ZINCRBY&nbsp;RANK:20220503&nbsp;20&nbsp;B<br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">为了演示，我们多加几个member。</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; background: #282c34; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;">ZINCRBY&nbsp;RANK:20220503&nbsp;14&nbsp;C<br>ZINCRBY&nbsp;RANK:20220503&nbsp;24&nbsp;D<br>ZINCRBY&nbsp;RANK:20220503&nbsp;14&nbsp;e<br>ZINCRBY&nbsp;RANK:20220503&nbsp;54&nbsp;f<br></code></pre>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span class="prefix" style="display: none;"></span><span class="content">3. 查看这个zet中的数据信息和排序输出</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">查看此zet数据</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; background: #282c34; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;">ZRANGE&nbsp;RANK:20220503&nbsp;0&nbsp;-1&nbsp;WITHSCORES<br>&gt;&nbsp;OUTPUT:<br>&nbsp;1)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"A"</span><br>&nbsp;2)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"8"</span><br>&nbsp;3)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"C"</span><br>&nbsp;4)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"14"</span><br>&nbsp;5)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"e"</span><br>&nbsp;6)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"14"</span><br>&nbsp;7)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"B"</span><br>&nbsp;8)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"20"</span><br>&nbsp;9)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"D"</span><br>10)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"24"</span><br>11)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"f"</span><br>12)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"54"</span><br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">按分数高低读取</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; background: #282c34; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;">ZREVRANGE&nbsp;RANK:20220503&nbsp;0&nbsp;9&nbsp;withscores<br>&gt;&nbsp;OUTPUT:<br>&nbsp;1)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"f"</span><br>&nbsp;2)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"54"</span><br>&nbsp;3)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"D"</span><br>&nbsp;4)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"24"</span><br>&nbsp;5)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"B"</span><br>&nbsp;6)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"20"</span><br>&nbsp;7)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"e"</span><br>&nbsp;8)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"14"</span><br>&nbsp;9)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"C"</span><br>10)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"14"</span><br>11)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"A"</span><br>12)&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"8"</span><br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">从结果可以看到，正确那个到的排行信息。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">总之，日榜、周榜、月榜、甚至年度榜单都可以用此思路，不过因为数据量和其他因素具体的实现细节可能有所差异，如果要查看历史榜单，可能不光需要使用redis了，还需要其余的持久化中间件支持，总之不能过度依赖redis。</p>
</section>